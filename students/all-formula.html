<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/assets/images/Logo of JUANOVA Cortex Tutor.png" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>All Formula - Prep100</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .formula-card { 
            transition: all 0.3s ease; 
            transform: perspective(1000px);
        }
        .formula-card:hover { 
            transform: perspective(1000px) translateY(-5px) rotateX(2deg); 
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); 
        }
        .mathjax { font-size: 1.3em; margin: 12px 0; }
        .copy-btn { 
            transition: all 0.2s ease; 
            background: linear-gradient(to right, #3b82f6, #2563eb);
        }
        .copy-btn:hover { 
            transform: scale(1.05); 
            background: linear-gradient(to right, #2563eb, #1e40af);
        }
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.5); 
            align-items: center; 
            justify-content: center; 
            z-index: 1000; 
        }
        .modal-content { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            width: 90%; 
            max-width: 500px; 
        }
    </style>
</head>
  <body class="bg-slate-50 text-slate-800">
    <div class="min-h-screen flex">
      <!-- Sidebar (canonical) -->
  <aside id="sidebar" class="w-72 fixed left-0 top-0 h-full bg-white border-r border-slate-200 p-5 flex flex-col gap-6 transition-transform duration-200 overflow-auto z-40">
        <div class="flex items-center gap-3">
          <img src="/assets/images/Logo%20of%20JUANOVA%20Cortex%20Tutor.png" alt="logo" class="h-12 w-12 rounded-full shadow-sm">
          <div>
            <div class="text-lg font-bold text-sky-700">JUANOVA CORTEX</div>
            <div class="text-xs text-slate-500">Student Dashboard</div>
          </div>
        </div>

        <nav class="flex-1 overflow-auto">
          <ul class="space-y-1">
            <li><a href="student-dashboard.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-home text-sky-600"></i> Home</a></li>
            <li><a href="news-feed-gemini.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-newspaper text-pink-500"></i> News Feed</a></li>
            <li><a href="ai-tutor-chatbot.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-robot text-purple-500"></i> AI Tutor</a></li>
            <li><a href="study-plan.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-calendar-check text-green-500"></i> Study Plan</a></li>
            <li><a href="all-formula.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-book-open text-teal-600"></i> All Formula</a></li>
            <li><a href="video-library.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-video text-red-500"></i> Video Library</a></li>
            <li><a href="mock-exams.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-pencil-alt text-orange-500"></i> Mock Exams</a></li>
            <li><a href="notifications.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-bell text-pink-600"></i> Notifications</a></li>
            <li><a href="student-live-session.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-chalkboard-teacher text-blue-400"></i> Live Sessions</a></li>
            <li><a href="smart-note.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-sticky-note text-yellow-500"></i> Smart Notes</a></li>
          </ul>
        </nav>

        <div class="text-sm text-slate-500">
          <div class="mb-2">Account</div>
          <div class="flex items-center gap-3">
            <img id="avatar-sm" src="../assets/images/unnamed.jpg" alt="avatar" class="h-10 w-10 rounded-full border">
            <div>
              <div id="userName" class="font-semibold">Student</div>
              <div id="userLevel" class="text-xs text-slate-400"></div>
            </div>
          </div>
        </div>
      </aside>

    <!-- Main area -->
    <div class="flex-1 flex flex-col ml-72">
            <!-- Top Bar (canonical) -->
            <header class="flex items-center justify-between p-4 bg-white border-b border-slate-200">
                        <div class="flex items-center gap-3">
                            <button id="toggleSidebar" class="p-2 rounded-md hover:bg-slate-100" title="Toggle sidebar"><i class="fas fa-bars"></i></button>
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                                <input id="searchInput" type="search" placeholder="Search formulas..." class="w-[520px] hidden md:inline-block pl-10 pr-4 py-2 rounded-full border border-slate-200 bg-white focus:outline-none focus:ring-2 focus:ring-sky-100">
                            </div>
                        </div>

                        <div class="flex items-center gap-4">
                            <div class="relative">
                                <button id="notifBtn" class="p-2 rounded-full hover:bg-slate-50" aria-label="Notifications"><i class="fas fa-bell text-sky-600"></i></button>
                                <span id="notifCount" class="absolute -top-1 -right-1 bg-pink-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">0</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="text-right mr-2">
                                    <div id="topName" class="font-semibold">Student Name</div>
                                    <div id="topLevel" class="text-xs text-slate-400">SS 3</div>
                                </div>
                                <img id="topAvatar" src="../assets/images/unnamed.jpg" alt="avatar" class="h-10 w-10 rounded-full border-2">
                            </div>
                        </div>
            </header>

        <main class="p-6 space-y-6">
        <!-- Banner / Header -->
        <div class="rounded-3xl bg-gradient-to-r from-yellow-500 to-yellow-400 text-white p-6 shadow mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-extrabold">All Formula</h1>
                        <p class="text-yellow-100 mt-1">Explore essential Physics, Chemistry, and Mathematics formulas in stylish cards.</p>
                    </div>
                    <button id="addFormulaBtn" class="bg-white text-yellow-500 px-4 py-2 rounded-full hover:bg-gray-100 transition"><i class="fas fa-plus mr-2"></i>Add Formula</button>
                </div>
            </div>

            <!-- Filter -->
            <div class="mb-6">
                <label for="subjectFilter" class="text-gray-700 font-semibold mr-2">Filter by Subject:</label>
                <select id="subjectFilter" class="border-2 border-gray-200 rounded-full px-4 py-2 focus:border-blue-500">
                    <option value="all">All Subjects</option>
                    <option value="Physics">Physics</option>
                    <option value="Chemistry">Chemistry</option>
                    <option value="Mathematics">Mathematics</option>
                </select>
            </div>

            <!-- Page specific content -->
            <div class="bg-white rounded-xl p-6 shadow">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="formulaContainer">
                    <!-- Area of a Circle -->
                    <div class="formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100" data-subject="Mathematics">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Area of a Circle</h3>
                        <div class="mathjax">\[ A = \pi r^2 \]</div>
                        <p class="text-gray-600 text-sm">Calculates the area of a circle given its radius.</p>
                        <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('A = \\pi r^2')">Copy Formula</button>
                    </div>
                    <!-- Ideal Gas Law -->
                    <div class="formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100" data-subject="Chemistry">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Ideal Gas Law</h3>
                        <div class="mathjax">\[ PV = nRT \]</div>
                        <p class="text-gray-600 text-sm">Relates pressure, volume, moles, gas constant, and temperature for an ideal gas.</p>
                        <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('PV = nRT')">Copy Formula</button>
                    </div>
                    <!-- Kinematic Equation (Velocity) -->
                    <div class="formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100" data-subject="Physics">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Kinematic Equation (Velocity)</h3>
                        <div class="mathjax">\[ v = u + at \]</div>
                        <p class="text-gray-600 text-sm">Final velocity is initial velocity plus acceleration times time.</p>
                        <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('v = u + at')">Copy Formula</button>
                    </div>
                    <!-- Mole Concept -->
                    <div class="formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100" data-subject="Chemistry">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Mole Concept</h3>
                        <div class="mathjax">\[ n = \frac{m}{M} \]</div>
                        <p class="text-gray-600 text-sm">Number of moles is mass divided by molar mass.</p>
                        <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('n = \\frac{m}{M}')">Copy Formula</button>
                    </div>
                    <!-- Newton's Second Law -->
                    <div class="formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100" data-subject="Physics">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Newton's Second Law</h3>
                        <div class="mathjax">\[ F = ma \]</div>
                        <p class="text-gray-600 text-sm">Force equals mass times acceleration, describing how objects move under external forces.</p>
                        <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('F = ma')">Copy Formula</button>
                    </div>
                    <!-- pH Calculation -->
                    <div class="formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100" data-subject="Chemistry">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">pH Calculation</h3>
                        <div class="mathjax">\[ \text{pH} = -\log[H^+] \]</div>
                        <p class="text-gray-600 text-sm">pH is the negative logarithm of hydrogen ion concentration.</p>
                        <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('\\text{pH} = -\\log[H^+]')">Copy Formula</button>
                    </div>
                    <!-- Pythagorean Theorem -->
                    <div class="formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100" data-subject="Mathematics">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Pythagorean Theorem</h3>
                        <div class="mathjax">\[ a^2 + b^2 = c^2 \]</div>
                        <p class="text-gray-600 text-sm">Relates the sides of a right triangle, where \( c \) is the hypotenuse.</p>
                        <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('a^2 + b^2 = c^2')">Copy Formula</button>
                    </div>
                    <!-- Quadratic Formula -->
                    <div class="formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100" data-subject="Mathematics">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Quadratic Formula</h3>
                        <div class="mathjax">\[ x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a} \]</div>
                        <p class="text-gray-600 text-sm">Solves quadratic equations of the form \( ax^2 + bx + c = 0 \).</p>
                        <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}')">Copy Formula</button>
                    </div>
                    <!-- Work Done -->
                    <div class="formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100" data-subject="Physics">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Work Done</h3>
                        <div class="mathjax">\[ W = Fd \cos\theta \]</div>
                        <p class="text-gray-600 text-sm">Work is force times displacement times the cosine of the angle between them.</p>
                        <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('W = Fd \\cos\\theta')">Copy Formula</button>
                    </div>
                </div>
            </div>

            <!-- Modal for Adding Formula -->
            <div id="addFormulaModal" class="modal">
                <div class="modal-content">
                    <h2 class="text-xl font-bold mb-4">Add New Formula</h2>
                    <form id="addFormulaForm">
                        <div class="mb-4">
                            <label for="formulaTitle" class="block text-gray-700 font-semibold">Title</label>
                            <input type="text" id="formulaTitle" class="w-full border-2 border-gray-200 rounded-lg px-4 py-2" required>
                        </div>
                        <div class="mb-4">
                            <label for="formulaLatex" class="block text-gray-700 font-semibold">LaTeX Formula</label>
                            <input type="text" id="formulaLatex" class="w-full border-2 border-gray-200 rounded-lg px-4 py-2" required>
                        </div>
                        <div class="mb-4">
                            <label for="formulaDescription" class="block text-gray-700 font-semibold">Description</label>
                            <textarea id="formulaDescription" class="w-full border-2 border-gray-200 rounded-lg px-4 py-2" required></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="formulaSubject" class="block text-gray-700 font-semibold">Subject</label>
                            <select id="formulaSubject" class="w-full border-2 border-gray-200 rounded-lg px-4 py-2" required>
                                <option value="Physics">Physics</option>
                                <option value="Chemistry">Chemistry</option>
                                <option value="Mathematics">Mathematics</option>
                            </select>
                        </div>
                        <div class="flex justify-end gap-4">
                            <button type="button" id="cancelFormulaBtn" class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300">Cancel</button>
                            <button type="submit" class="px-4 py-2 rounded-full bg-blue-500 text-white hover:bg-blue-600">Add</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
            if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
                try {
                    var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                    var firstSheetName = workbook.SheetNames[0];
                    var worksheet = workbook.Sheets[firstSheetName];
                    var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                    var filteredData = jsonData.filter(row => row.some(filledCell));
                    var headerRowIndex = filteredData.findIndex((row, index) =>
                      row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                    );
                    if (headerRowIndex === -1 || headerRowIndex > 25) {
                      headerRowIndex = 0;
                    }
                    var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex));
                    csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                    return csv;
                } catch (e) {
                    console.error(e);
                    return "";
                }
            }
            return gk_fileData[filename] || "";
        }

        // Wait for MathJax to be ready before typesetting
        window.MathJax = {
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.promise.then(() => {
                        MathJax.typeset();
                    });
                }
            }
        };

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Formula copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        // Personalize: replace generic Student name/avatar with signed-in user initials when available
        import('./js/firebase-user-helper.js').then(({ initUserPersonalization }) => {
            initUserPersonalization(async ({ user, helpers }) => {
                if (!user) return;
                const fullName = user.displayName || 'Student';
                const short = (fullName.split(' ')[0] || fullName).split(' ')[0];
                const topName = document.getElementById('topName'); if (topName) topName.textContent = fullName;
                const userName = document.getElementById('userName'); if (userName) userName.textContent = fullName;
                                const userLevel = document.getElementById('userLevel');
                                if (userLevel) {
                                    const l = (user && user.profile && user.profile.level) ? user.profile.level : '';
                                    userLevel.textContent = l && String(l).startsWith('SS') ? l : (l ? 'SS 3' : '');
                                }
                const nameEl = document.getElementById('student-name');
                if (nameEl) nameEl.textContent = short;
                const notif = document.getElementById('notification-count');
                if (notif && helpers && helpers.getUnreadNotificationsCount) notif.textContent = String(await helpers.getUnreadNotificationsCount(user.uid));
                const avatar = document.getElementById('user-avatar');
                if (avatar) {
                    if (user.photoURL) avatar.src = user.photoURL;
                    else if (helpers && helpers.initialsFromName) avatar.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(helpers.initialsFromName(fullName))}&background=2563eb&color=fff&length=2`;
                }
            });
        }).catch(e => console.warn('firebase-user helper import failed', e));

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const formulaCards = document.querySelectorAll('.formula-card');
            formulaCards.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                const description = card.querySelector('p').textContent.toLowerCase();
                if (title.includes(searchTerm) || description.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

    // Ensure sidebar toggle works
    (function ensureSidebarToggle(){ try{ const btn=document.getElementById('toggleSidebar'); if(btn && !btn.dataset.hasToggle){ btn.addEventListener('click', ()=> document.getElementById('sidebar').classList.toggle('-translate-x-full')); btn.dataset.hasToggle='1'; } }catch(e){} })();

        // Filter functionality
        document.getElementById('subjectFilter').addEventListener('change', function(e) {
            const selectedSubject = e.target.value;
            const formulaCards = document.querySelectorAll('.formula-card');
            formulaCards.forEach(card => {
                const cardSubject = card.getAttribute('data-subject');
                if (selectedSubject === 'all' || cardSubject === selectedSubject) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Modal functionality
        const modal = document.getElementById('addFormulaModal');
        const addFormulaBtn = document.getElementById('addFormulaBtn');
        const cancelFormulaBtn = document.getElementById('cancelFormulaBtn');
        const addFormulaForm = document.getElementById('addFormulaForm');

        addFormulaBtn.addEventListener('click', () => {
            modal.style.display = 'flex';
        });

        cancelFormulaBtn.addEventListener('click', () => {
            modal.style.display = 'none';
            addFormulaForm.reset();
        });

        addFormulaForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('formulaTitle').value;
            const latex = document.getElementById('formulaLatex').value;
            const description = document.getElementById('formulaDescription').value;
            const subject = document.getElementById('formulaSubject').value;

            const formulaContainer = document.getElementById('formulaContainer');
            const newCard = document.createElement('div');
            newCard.className = 'formula-card bg-white p-6 rounded-xl shadow-lg border border-gray-100';
            newCard.setAttribute('data-subject', subject);
            newCard.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-800 mb-2">${title}</h3>
                <div class="mathjax">\[ ${latex} \]</div>
                <p class="text-gray-600 text-sm">${description}</p>
                <button class="copy-btn text-white px-4 py-2 rounded-full mt-4 w-full" onclick="copyToClipboard('${latex}')">Copy Formula</button>
            `;
            formulaContainer.appendChild(newCard);
            MathJax.typeset();

            modal.style.display = 'none';
            addFormulaForm.reset();
        });
    </script>