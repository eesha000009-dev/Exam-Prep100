<!DOCTYPE html>
<html lang="en">
<head>
    <script src="../js/instant-user-loader.js"></script>
  <!-- Favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Practice Exams - Prep100</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Autosize library for dynamic textarea resizing -->
  <script src="https://cdn.jsdelivr.net/npm/autosize@5.0.2/dist/autosize.min.js"></script>
  <style>
    /* Ensure textareas and inputs don't overflow */
    textarea, input[type="text"] {
      max-width: 100%;
      box-sizing: border-box;
    }
    /* Style for address textareas */
    .address-textarea {
      resize: none;
      height: 60px;
      min-height: 60px;
    }
    /* Dynamic input width */
    input.dynamic-width {
      width: auto;
      min-width: 200px;
      max-width: 100%;
      transition: width 0.2s ease;
    }
  </style>
</head>
  <body class="bg-slate-50 text-slate-800">
    <div class="min-h-screen flex">
      <!-- Sidebar -->
    <aside id="sidebar" class="w-72 fixed left-0 top-0 h-full bg-white border-r border-slate-200 p-5 flex flex-col gap-6 transition-transform duration-200 overflow-auto z-40">
        <div class="flex items-center gap-3">
          <img src="/assets/images/logo.png" alt="logo" class="h-12 w-12 rounded-full shadow-sm">
          <div>
            <div class="text-lg font-bold text-sky-700">JUANOVA CORTEX</div>
            <div class="text-xs text-slate-500">Student Dashboard</div>
          </div>
        </div>

        <nav class="flex-1 overflow-auto">
          <ul class="space-y-1">
            <li><a href="student-dashboard.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-home text-sky-600"></i> Home</a></li>
            <li><a href="news-feed-gemini.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-newspaper text-pink-500"></i> News Feed</a></li>
            <li><a href="ai-tutor-chatbot.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-robot text-purple-500"></i> AI Tutor</a></li>
            <li><a href="study-plan.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-calendar-check text-green-500"></i> Study Plan</a></li>
           <li><a href="all-formula.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-book-open text-teal-600"></i> All Formula</a></li>
            <li><a href="video-library.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-video text-red-500"></i> Video Library</a></li>
            <li><a href="mock-exams.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-pencil-alt text-orange-500"></i> Mock Exams</a></li>
            <li><a href="notifications.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-bell text-pink-600"></i> Notifications</a></li>
            <li><a href="student-live-session.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-chalkboard-teacher text-blue-400"></i> Live Sessions</a></li>
            <li><a href="smart-note.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50"><i class="fas fa-sticky-note text-yellow-500"></i> Smart Notes</a></li>
          </ul>
        </nav>

        <div class="text-sm text-slate-500">
          <div class="mb-2">Account</div>
          <div class="flex items-center gap-3">
            <img id="avatar-sm" src="../assets/images/unnamed.jpg" alt="avatar" class="h-10 w-10 rounded-full border">
            <div>
              <div id="userName" class="font-semibold">Student</div>
              <div id="userLevel" class="text-xs text-slate-400"></div>
            </div>
          </div>
        </div>
      </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8 lg:ml-72 ml-0 pt-16 lg:pt-0">
            <!-- Top Bar -->
            <div class="flex items-center justify-between mb-8">
                <div class="flex-1 max-w-xl relative">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" class="w-full pl-12 pr-4 py-3 rounded-full border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-100 bg-white" placeholder="Search topics, subjects, or questions...">
                </div>
                <div class="flex items-center gap-4">
                    <span class="bg-blue-100 text-blue-700 px-4 py-1 rounded-full font-semibold text-sm">SS 3</span>
                    <span class="font-semibold text-gray-700">Student</span>
                    <div class="relative">
                        <button class="p-2 rounded-full hover:bg-blue-100 transition" aria-label="Notifications" title="Notifications">
                            <i class="fas fa-bell text-blue-600 text-lg"></i>
                            <span class="absolute -top-1 -right-1 bg-pink-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">3</span>
                        </button>
                    </div>
                    <img src="../assets/images/unnamed.jpg" alt="User" class="h-10 w-10 rounded-full border-2 border-blue-500">
                </div>
            </div>

            <!-- Page Title -->
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Mock Exams</h1>

            <!-- Cards Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="main-cards">
                <div class="bg-white rounded-2xl p-6 shadow hover:shadow-lg transition cursor-pointer" onclick="showTopics()">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Topic-by-topic</h2>
                    <p class="text-gray-600">Practice by subject and topic in JAMB CBT format with past WAEC questions</p>
                </div>
                <div class="bg-white rounded-2xl p-6 shadow hover:shadow-lg transition cursor-pointer" onclick="showYearly()">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Year-by-year</h2>
                    <p class="text-gray-600">Practice past WAEC years in JAMB CBT format</p>
                </div>
                <div class="bg-white rounded-2xl p-6 shadow hover:shadow-lg transition cursor-pointer" onclick="showEssay()">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">English Essay Writing</h2>
                    <p class="text-gray-600">Practice WAEC/NECO essay types with auto topics and COEM marking</p>
                </div>
            </div>

            <!-- Dynamic Content Section -->
            <div id="dynamic-content" class="mt-8"></div>

            <!-- Quick Actions Toolbar -->
            <div id="toolbar" class="fixed bottom-8 right-12">
                <div class="relative group">
                    <button id="toolsButton" onclick="toggleToolsMenu()" title="Learning Tools" aria-label="Toggle Learning Tools" class="text-purple-500 hover:text-purple-700 transition-colors p-2">
                        <i class="fas fa-toolbox text-4xl drop-shadow-lg hover:scale-110 transform transition-transform" aria-hidden="true"></i>
                    </button>

                    <div id="toolsMenu" class="hidden absolute bottom-14 right-0 bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl overflow-hidden min-w-[220px] border border-purple-100/50">
                        <button onclick="openTool('ai-tutor')" class="w-full px-6 py-4 flex items-center gap-4 hover:bg-purple-50 transition-all text-left group">
                            <i class="fas fa-robot text-xl text-purple-500 group-hover:scale-110 transition-transform"></i>
                            <span class="text-gray-700 group-hover:text-purple-600 font-medium">AI Tutor</span>
                        </button>
                        <button onclick="openTool('smart-notes')" class="w-full px-6 py-4 flex items-center gap-4 hover:bg-yellow-50 transition-all text-left group border-t border-purple-100/30">
                            <i class="fas fa-sticky-note text-xl text-yellow-500 group-hover:scale-110 transition-transform"></i>
                            <span class="text-gray-700 group-hover:text-yellow-600 font-medium">Smart Notes</span>
                        </button>
                        <button onclick="openTool('formula')" class="w-full px-6 py-4 flex items-center gap-4 hover:bg-teal-50 transition-all text-left group border-t border-purple-100/30">
                            <i class="fas fa-superscript text-xl text-teal-500 group-hover:scale-110 transition-transform"></i>
                            <span class="text-gray-700 group-hover:text-teal-600 font-medium">Formula Tool</span>
                        </button>
                        <button onclick="openTool('dictionary')" class="w-full px-6 py-4 flex items-center gap-4 hover:bg-amber-50 transition-all text-left group border-t border-purple-100/30">
                            <i class="fas fa-book-reader text-xl text-amber-500 group-hover:scale-110 transition-transform"></i>
                            <span class="text-gray-700 group-hover:text-amber-600 font-medium">Dictionary</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tool Windows (Initially Hidden) -->
            <div id="smart-notes-window" class="hidden fixed bg-white rounded-lg shadow-2xl p-4 w-80 cursor-move z-[1000]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-yellow-600">Smart Notes</h3>
                    <button onclick="closeTool('smart-notes')" class="text-gray-500 hover:text-gray-700" title="Close Smart Notes" aria-label="Close Smart Notes">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <textarea id="smart-notes-input" class="w-full p-2 border rounded-lg mb-2" rows="4" placeholder="Write your note..."></textarea>
                <button onclick="saveNote()" class="w-full bg-yellow-500 text-white py-2 rounded-lg hover:bg-yellow-600">Save Note</button>
            </div>

            <div id="formula-window" class="hidden fixed bg-white rounded-lg shadow-2xl p-4 w-80 cursor-move z-[1000]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-teal-600">Formula Tool</h3>
                    <button onclick="closeTool('formula')" class="text-gray-500 hover:text-gray-700" title="Close Formula Tool" aria-label="Close Formula Tool">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <input type="text" id="formula-name" class="w-full p-2 border rounded-lg mb-2 dynamic-width" placeholder="Formula Name">
                <textarea id="formula-input" class="w-full p-2 border rounded-lg mb-2" rows="3" placeholder="Enter your formula..."></textarea>
                <button onclick="saveFormula()" class="w-full bg-teal-600 text-white py-2 rounded-lg hover:bg-teal-700">Save Formula</button>
            </div>

            <div id="dictionary-window" class="hidden fixed bg-white rounded-lg shadow-2xl p-4 w-80 cursor-move z-[1000]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-amber-600">Dictionary</h3>
                    <button onclick="closeTool('dictionary')" class="text-gray-500 hover:text-gray-700" title="Close Dictionary" aria-label="Close Dictionary">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <input type="text" id="dictionary-search" class="w-full p-2 border rounded-lg mb-2 dynamic-width" placeholder="Search word...">
                <div id="dictionary-result" class="text-gray-600"></div>
            </div>
        </main>
    </div>

    <script>
        // Subject styles for dashboard-like cards
        const subjectStyles = {
            "MATHEMATICS": { gradient: 'from-blue-600 to-blue-400', icon: 'fas fa-square-root-alt' },
            "BIOLOGY": { gradient: 'from-green-500 to-green-300', icon: 'fas fa-dna' },
            "CHEMISTRY": { gradient: 'from-pink-500 to-pink-300', icon: 'fas fa-flask' },
            "PHYSICS": { gradient: 'from-yellow-500 to-yellow-300', icon: 'fas fa-atom' },
            "ENGLISH": { gradient: 'from-indigo-500 to-indigo-300', icon: 'fas fa-book' },
            "LITERATURE": { gradient: 'from-purple-500 to-purple-300', icon: 'fas fa-feather' },
            "GOVERNMENT": { gradient: 'from-red-500 to-red-300', icon: 'fas fa-landmark' },
            "ECONOMICS": { gradient: 'from-teal-500 to-teal-300', icon: 'fas fa-chart-pie' },
            "COMMERCE": { gradient: 'from-orange-500 to-orange-300', icon: 'fas fa-balance-scale' },
            "ACCOUNTING": { gradient: 'from-gray-700 to-gray-400', icon: 'fas fa-calculator' }
        };

        // Subjects for topic-by-topic and year-by-year
        const subjects = [
            "MATHEMATICS", "BIOLOGY", "CHEMISTRY", "LITERATURE", "PHYSICS", "ENGLISH", "ECONOMICS", "ACCOUNTING", "GOVERNMENT", "COMMERCE"
        ];

        // Sample topics for each subject
        const subjectTopics = {
            "MATHEMATICS": ["Algebra", "Geometry", "Trigonometry", "Calculus", "Statistics"],
            "BIOLOGY": ["Cell Biology", "Genetics", "Ecology", "Human Physiology", "Plant Biology"],
            "CHEMISTRY": ["Organic Chemistry", "Inorganic Chemistry", "Physical Chemistry", "Chemical Reactions"],
            "PHYSICS": ["Mechanics", "Electricity and Magnetism", "Waves", "Thermodynamics"],
            "ENGLISH": ["Comprehension", "Grammar", "Vocabulary", "Summary"],
            "LITERATURE": ["Prose", "Poetry", "Drama"],
            "GOVERNMENT": ["Constitution", "Political Systems", "Governance"],
            "ECONOMICS": ["Microeconomics", "Macroeconomics", "Economic Systems"],
            "COMMERCE": ["Trade", "Business Organizations", "Marketing"],
            "ACCOUNTING": ["Financial Accounting", "Cost Accounting", "Bookkeeping"]
        };

        // Placeholder for real WAEC past questions
        // Populate this object with questions from WAEC e-learning portal (http://waeconline.org.ng/e-learning/index.htm)
        // or other legitimate sources like MySchoolGist (https://www.myschoolgist.com/ng/waec-past-questions/)
        const waecQuestions = {
            "MATHEMATICS": {
                "Algebra": {
                    "2023": [
                        // Example from MySchoolGist[](https://myschoolgist.com/ng/waec-maths-past-questions/)
                        {
                            question: "If the 2nd and 5th terms of a G.P. are 6 and 48 respectively, find the sum of the first four terms.",
                            options: ["45", "54", "63", "84"],
                            answer: "84"
                        },
                        // Add more questions from WAEC sources
                        // e.g., { question: "...", options: ["...", "...", "...", "..."], answer: "..." }
                    ],
                    "2022": [
                        // Add real WAEC questions for 2022
                    ],
                    // Add more years as needed
                },
                "Geometry": {
                    "2023": [
                        // Add real WAEC questions for Geometry 2023
                    ],
                    // Add more years
                },
                "Trigonometry": {
                    // Add years and questions
                },
                "Calculus": {
                    // Add years and questions
                },
                "Statistics": {
                    // Add years and questions
                }
            },
            "BIOLOGY": {
                "Cell Biology": {
                    "2023": [
                        // Add real WAEC questions from http://waeconline.org.ng/e-learning/index.htm
                    ],
                    "2022": [
                        // Add real WAEC questions
                    ]
                },
                "Genetics": {
                    // Add years and questions
                },
                // Add other topics
            },
            "CHEMISTRY": {
                "Organic Chemistry": {
                    "2023": [
                        // Add real WAEC questions
                    ]
                },
                // Add other topics and years
            },
            "PHYSICS": {
                "Mechanics": {
                    "2023": [
                        // Add real WAEC questions
                    ]
                },
                // Add other topics and years
            },
            "ENGLISH": {
                "Comprehension": {
                    "2023": [
                        // Example from MySchoolGist[](https://myschoolgist.com/ng/waec-english-past-questions/)
                        {
                            question: "According to the passage, what is the primary purpose of education? (Assume a passage was provided)",
                            options: ["To acquire wealth", "To gain knowledge and skills", "To secure employment", "To achieve social status"],
                            answer: "To gain knowledge and skills"
                        },
                        // Add more questions from WAEC sources
                    ],
                    "2022": [
                        // Add real WAEC questions
                    ]
                },
                "Grammar": {
                    // Add years and questions
                },
                "Vocabulary": {
                    // Add years and questions
                },
                "Summary": {
                    // Add years and questions
                }
            },
            "LITERATURE": {
                "Prose": {
                    "2023": [
                        // Add real WAEC questions
                    ]
                },
                // Add other topics and years
            },
            "GOVERNMENT": {
                "Constitution": {
                    "2023": [
                        // Add real WAEC questions
                    ]
                },
                // Add other topics and years
            },
            "ECONOMICS": {
                "Microeconomics": {
                    "2023": [
                        // Add real WAEC questions
                    ]
                },
                // Add other topics and years
            },
            "COMMERCE": {
                "Trade": {
                    "2023": [
                        // Add real WAEC questions
                    ]
                },
                // Add other topics and years
            },
            "ACCOUNTING": {
                "Financial Accounting": {
                    "2023": [
                        // Add real WAEC questions
                    ]
                },
                // Add other topics and years
            }
        };

        // Essay topics
        const essayTopics = {
            "Informal Letter": [
                "Write a letter to your friend telling him/her about your new school.",
                "Write a letter to your uncle thanking him for the birthday present.",
                "Write a letter to your cousin describing a recent family event."
            ],
            "Formal Letter": [
                "Write a letter to the principal requesting permission for a school trip.",
                "Write a letter to the editor of a newspaper about environmental pollution.",
                "Write a letter applying for a scholarship."
            ],
            "Speech": [
                "Write a speech on the importance of education.",
                "Write a speech about the effects of social media on youth.",
                "Write a speech on climate change."
            ],
            "Descriptive Essay": [
                "Describe your favorite place.",
                "Describe a memorable journey.",
                "Describe a market scene."
            ],
            "Narrative Essay": [
                "Narrate an experience that changed your life.",
                "Narrate a story about overcoming a challenge.",
                "Narrate an adventure in the forest."
            ],
            "Argumentative Essay": [
                "Argue for or against the use of mobile phones in schools.",
                "Argue whether technology is a blessing or a curse.",
                "Argue for or against capital punishment."
            ],
            "Expository Essay": [
                "Explain the causes and effects of deforestation.",
                "Explain how to prepare for examinations.",
                "Explain the process of photosynthesis."
            ]
        };

        // Example essay types
        const essayTypes = Object.keys(essayTopics);

        // Initialize autosize for textareas
        document.addEventListener('DOMContentLoaded', () => {
            autosize(document.querySelectorAll('textarea'));
            // Dynamic width for inputs
            document.querySelectorAll('input.dynamic-width').forEach(input => {
                input.addEventListener('input', adjustInputWidth);
            });
        });

        // Adjust input width based on content
        function adjustInputWidth(e) {
            const input = e.target;
            const tmp = document.createElement('span');
            tmp.style.fontSize = window.getComputedStyle(input).fontSize;
            tmp.style.fontFamily = window.getComputedStyle(input).fontFamily;
            tmp.style.padding = window.getComputedStyle(input).padding;
            tmp.style.whiteSpace = 'pre';
            tmp.textContent = input.value || input.placeholder;
            document.body.appendChild(tmp);
            const width = tmp.offsetWidth + 20; // Add padding
            document.body.removeChild(tmp);
            input.style.width = `${Math.min(Math.max(width, 200), window.innerWidth - 40)}px`;
        }

        // Toggle View All subjects
        function toggleViewAllSubjects() {
            const btn = document.getElementById('view-all-subjects');
            const hiddenSubjects = document.querySelectorAll('.subject-card.hidden');
            const anyHidden = hiddenSubjects.length > 0 && Array.from(hiddenSubjects).some(el => el.classList.contains('hidden'));

            if (anyHidden) {
                hiddenSubjects.forEach(el => el.classList.remove('hidden'));
                btn.textContent = 'Show Less';
            } else {
                const allCards = document.querySelectorAll('.subject-card');
                allCards.forEach((el, idx) => {
                    if (idx >= 5) el.classList.add('hidden');
                });
                btn.textContent = 'View All';
            }
        }

        // Basic tools menu handlers
        function toggleToolsMenu() {
            const menu = document.getElementById('toolsMenu');
            const isHidden = menu.classList.contains('hidden');
            if (isHidden) {
                menu.classList.remove('hidden');
                setTimeout(() => {
                    const closeMenu = (e) => {
                        if (!menu.contains(e.target) && !e.target.closest('#toolsButton')) {
                            menu.classList.add('hidden');
                            document.removeEventListener('click', closeMenu);
                        }
                    };
                    document.addEventListener('click', closeMenu);
                }, 0);
            } else {
                menu.classList.add('hidden');
            }
        }

        function openTool(name) {
            document.getElementById('toolsMenu').classList.add('hidden');
            if (name === 'ai-tutor') {
                window.location.href = 'ai-tutor-chatbot.html';
                return;
            }
            const el = document.getElementById(`${name}-window`);
            if (el) el.classList.remove('hidden');
            autosize.update(document.querySelectorAll('textarea'));
            document.querySelectorAll('input.dynamic-width').forEach(input => adjustInputWidth({ target: input }));
        }

        function closeTool(name) {
            const el = document.getElementById(`${name}-window`);
            if (el) el.classList.add('hidden');
        }

        // Save smart notes/formula
        function saveNote() {
            const noteInput = document.getElementById('smart-notes-input');
            if (!noteInput || !noteInput.value.trim()) return;
            const notes = JSON.parse(localStorage.getItem('smartNotes') || '[]');
            notes.push({ id: Date.now(), text: noteInput.value, timestamp: new Date().toISOString() });
            localStorage.setItem('smartNotes', JSON.stringify(notes));
            noteInput.value = '';
            alert('Note saved');
        }

        function saveFormula() {
            const nameInput = document.getElementById('formula-name');
            const formulaInput = document.getElementById('formula-input');
            if (!nameInput || !formulaInput) return;
            if (!nameInput.value.trim() || !formulaInput.value.trim()) return;
            const formulas = JSON.parse(localStorage.getItem('formulas') || '[]');
            formulas.push({ id: Date.now(), name: nameInput.value, formula: formulaInput.value, timestamp: new Date().toISOString() });
            localStorage.setItem('formulas', JSON.stringify(formulas));
            nameInput.value = '';
            formulaInput.value = '';
            alert('Formula saved');
        }

        function showTopics() {
            document.getElementById('main-cards').style.display = 'none';
            const content = document.getElementById('dynamic-content');

            content.innerHTML = `
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Select a Subject</h2>
                    <button id="view-all-subjects" class="border border-blue-500 text-blue-600 px-5 py-1.5 rounded-full font-semibold hover:bg-blue-50 transition" onclick="toggleViewAllSubjects()">View All</button>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                    ${subjects.map((sub, i) => {
                        const style = subjectStyles[sub] || { gradient: 'from-gray-400 to-gray-200', icon: 'fas fa-book' };
                        const hiddenClass = i >= 5 ? 'hidden' : '';
                        return `
                            <button onclick='showSubjectTopics("${sub}")' class="subject-card ${hiddenClass} flex flex-col items-center justify-center gap-2 p-6 rounded-2xl font-bold text-white text-lg shadow-lg bg-gradient-to-br ${style.gradient} hover:scale-105 transition">
                                <i class="${style.icon} text-3xl"></i>
                                <span class="mt-1">${sub}</span>
                            </button>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function showSubjectTopics(subject) {
            const topics = subjectTopics[subject] || ["No topics available"];
            const content = document.getElementById('dynamic-content');
            content.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">${subject} Topics</h2>
                    <div class="flex items-center gap-2">
                        <button class="px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700 hover:bg-gray-50" onclick="showTopics()">Back</button>
                        <button class="px-4 py-2 rounded-full bg-gray-100 text-gray-700" onclick="backToMain()">Main Options</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-[60vh] overflow-auto">
                    ${topics.map(topic => `
                        <div onclick='startCBT("${subject}", "${topic}", "topic")' class="bg-white p-4 rounded-xl shadow hover:shadow-lg cursor-pointer transition">
                            <h3 class="text-gray-800 font-semibold">${topic}</h3>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showYearly() {
            document.getElementById('main-cards').style.display = 'none';
            const content = document.getElementById('dynamic-content');
            content.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Select a Subject</h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                    ${subjects.map(sub => `
                        <button onclick='showYears("${sub}")' class="flex flex-col items-center justify-center gap-2 p-6 rounded-2xl font-bold text-white text-lg shadow-lg bg-gradient-to-br from-indigo-600 to-indigo-400 hover:scale-105 transition">
                            <i class="fas fa-calendar-alt text-3xl"></i>
                            <span class="mt-1">${sub}</span>
                        </button>
                    `).join('')}
                </div>
            `;
        }

        function showYears(subject) {
            const years = [2023, 2022, 2021, 2020, 2019, 2018, 2017, 2016, 2015, 2014];
            const content = document.getElementById('dynamic-content');
            content.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">${subject} — Select Year</h2>
                    <button class="px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700" onclick='showYearly()'>Back</button>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    ${years.map(year => `
                        <div onclick='startCBT("${subject}", "${year}", "year")' class="bg-white p-4 rounded-xl shadow hover:shadow-lg cursor-pointer transition text-center font-semibold text-gray-800">${year}</div>
                    `).join('')}
                </div>
            `;
        }

        let currentQuestion = 0;
        let timerInterval;
        let timeLeft = 2400; // 40 minutes in seconds
        let answers = {};
        let currentQuestions = [];

        function startCBT(subject, identifier, mode) {
            // Select questions based on mode (topic or year)
            if (mode === "topic") {
                const topics = Object.keys(waecQuestions[subject] || {});
                currentQuestions = topics.includes(identifier) ? (waecQuestions[subject][identifier]["2023"] || []) : [];
            } else if (mode === "year") {
                const topics = Object.keys(waecQuestions[subject] || {});
                currentQuestions = [];
                topics.forEach(topic => {
                    if (waecQuestions[subject][topic][identifier]) {
                        currentQuestions = currentQuestions.concat(waecQuestions[subject][topic][identifier]);
                    }
                });
            }

            if (currentQuestions.length === 0) {
                currentQuestions = [
                    { question: "No questions available for this selection. Please obtain real WAEC questions from http://waeconline.org.ng/e-learning/index.htm or other legitimate sources.", options: ["N/A"], answer: "N/A" }
                ];
            }

            const content = document.getElementById('dynamic-content');
            content.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">${subject} — ${identifier} (WAEC CBT Mode)</h2>
                    <div id="timer" class="text-red-600 font-bold">Time: 40:00</div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow">
                    <div id="question-container"></div>
                    <div class="mt-4 flex justify-between">
                        <button id="prev-btn" class="px-4 py-2 bg-gray-200 rounded-lg" onclick="changeQuestion(-1)">Previous (P)</button>
                        <button id="next-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg" onclick="changeQuestion(1)">Next (N)</button>
                        <button id="submit-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg" onclick="submitExam()">Submit (S)</button>
                    </div>
                    <div class="mt-4">
                        <p class="text-gray-600">Use keyboard: A/B/C/D to select, N next, P prev, S submit, R revert.</p>
                    </div>
                </div>
            `;

            currentQuestion = 0;
            answers = {};
            timeLeft = 2400;
            startTimer();
            displayQuestion(currentQuestions);
            setupKeyboardShortcuts(currentQuestions);
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                document.getElementById('timer').textContent = `Time: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitExam();
                }
            }, 1000);
        }

        function displayQuestion(questions) {
            const q = questions[currentQuestion];
            document.getElementById('question-container').innerHTML = `
                <p class="font-semibold text-gray-800 mb-4">Question ${currentQuestion + 1}: ${q.question}</p>
                <div class="flex flex-col gap-2">
                    ${q.options.map((opt, idx) => `
                        <label class="flex items-center gap-2">
                            <input type="radio" name="answer" value="${opt}" ${answers[currentQuestion] === opt ? 'checked' : ''} onclick="saveAnswer('${opt}')">
                            ${String.fromCharCode(65 + idx)}. ${opt}
                        </label>
                    `).join('')}
                </div>
            `;
        }

        function saveAnswer(answer) {
            answers[currentQuestion] = answer;
        }

        function changeQuestion(delta) {
            currentQuestion += delta;
            if (currentQuestion < 0) currentQuestion = 0;
            if (currentQuestion >= currentQuestions.length) currentQuestion = currentQuestions.length - 1;
            displayQuestion(currentQuestions);
        }

        function submitExam() {
            clearInterval(timerInterval);
            let score = 0;
            currentQuestions.forEach((q, idx) => {
                if (answers[idx] === q.answer) score++;
            });
            alert(`Exam submitted! Your score: ${score}/${currentQuestions.length}`);
            backToMain();
        }

        function setupKeyboardShortcuts(questions) {
            document.removeEventListener('keydown', handleKeydown); // Remove previous listener
            document.addEventListener('keydown', handleKeydown);
            function handleKeydown(e) {
                const key = e.key.toUpperCase();
                if (['A', 'B', 'C', 'D'].includes(key)) {
                    const idx = key.charCodeAt(0) - 65;
                    if (idx < questions[currentQuestion].options.length) {
                        const opt = questions[currentQuestion].options[idx];
                        saveAnswer(opt);
                        displayQuestion(questions);
                    }
                } else if (key === 'N') {
                    changeQuestion(1);
                } else if (key === 'P') {
                    changeQuestion(-1);
                } else if (key === 'S') {
                    submitExam();
                } else if (key === 'R') {
                    delete answers[currentQuestion];
                    displayQuestion(questions);
                }
            }
        }

        function showEssay() {
            document.getElementById('main-cards').style.display = 'none';
            const content = document.getElementById('dynamic-content');
            content.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Select Essay Type</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${essayTypes.map(type => `
                        <div onclick='showEssayForm("${type}")' class="bg-white p-6 rounded-xl shadow hover:shadow-lg cursor-pointer transition">
                            <h3 class="font-semibold text-gray-800">${type}</h3>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showEssayForm(type) {
            const topics = essayTopics[type] || [];
            const randomTopic = topics[Math.floor(Math.random() * topics.length)] || "No topics available";

            let formHtml = '';
            if (type === "Informal Letter") {
                formHtml = `
                    <div class="flex flex-col gap-4">
                        <textarea class="address-textarea self-end w-56 p-2 border rounded-md" placeholder="Your Address"></textarea>
                        <textarea class="address-textarea self-end w-40 p-2 border rounded-md" placeholder="Date"></textarea>
                        <input type="text" class="dynamic-width w-72 p-2 border rounded-md" placeholder="Dear Friend," />
                        <textarea id="essay-body" placeholder="Body of the letter..." class="w-full min-h-[180px] p-3 border rounded-lg"></textarea>
                        <input type="text" class="dynamic-width self-end w-72 p-2 border rounded-md" placeholder="Yours sincerely," />
                    </div>
                `;
            } else if (type === "Formal Letter") {
                formHtml = `
                    <div class="flex flex-col gap-4">
                        <textarea class="address-textarea w-56 p-2 border rounded-md" placeholder="Recipient's Address"></textarea>
                        <textarea class="address-textarea self-end w-56 p-2 border rounded-md" placeholder="Your Address"></textarea>
                        <textarea class="address-textarea self-end w-40 p-2 border rounded-md" placeholder="Date"></textarea>
                        <input type="text" class="dynamic-width w-full p-2 border rounded-md" placeholder="Subject" />
                        <input type="text" class="dynamic-width w-72 p-2 border rounded-md" placeholder="Dear Sir/Madam," />
                        <textarea id="essay-body" placeholder="Body of the letter..." class="w-full min-h-[180px] p-3 border rounded-lg"></textarea>
                        <input type="text" class="dynamic-width self-end w-72 p-2 border rounded-md" placeholder="Yours faithfully," />
                    </div>
                `;
            } else if (type === "Speech") {
                formHtml = `
                    <div class="flex flex-col gap-4">
                        <input type="text" class="dynamic-width w-full p-2 border rounded-md" placeholder="Title of Speech" />
                        <input type="text" class="dynamic-width w-full p-2 border rounded-md" placeholder="Salutation (e.g., Ladies and Gentlemen)" />
                        <textarea id="essay-body" placeholder="Body of the speech..." class="w-full min-h-[180px] p-3 border rounded-lg"></textarea>
                        <input type="text" class="dynamic-width w-full p-2 border rounded-md" placeholder="Closing remarks" />
                    </div>
                `;
            } else {
                formHtml = `
                    <div class="flex flex-col gap-4">
                        <input type="text" class="dynamic-width w-full p-2 border rounded-md" placeholder="Essay Title" />
                        <textarea id="essay-body" placeholder="Write your essay here..." class="w-full min-h-[220px] p-3 border rounded-lg"></textarea>
                    </div>
                `;
            }

            const content = document.getElementById('dynamic-content');
            content.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">${type}</h2>
                    <button class="px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-700" onclick='showEssay()'>Back</button>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow">
                    <p class="font-semibold text-gray-800 mb-4">Topic: ${randomTopic}</p>
                    ${formHtml}
                    <div class="mt-4 flex gap-2">
                        <button class="px-4 py-2 bg-blue-600 text-white rounded-lg" onclick="submitEssay()">Submit Essay</button>
                    </div>
                    <p class="mt-4 text-gray-600">Your essay will be marked using WAEC COEM standard: Content (10), Organization (10), Expression (20), Mechanical Accuracy (10).</p>
                </div>
            `;

            // Initialize autosize for textareas and dynamic width for inputs
            autosize(document.querySelectorAll('textarea'));
            document.querySelectorAll('input.dynamic-width').forEach(input => {
                input.addEventListener('input', adjustInputWidth);
                adjustInputWidth({ target: input });
            });
        }

        function submitEssay() {
            const body = document.getElementById('essay-body').value;
            if (!body.trim()) {
                alert('Please write your essay.');
                return;
            }
            alert('Essay submitted for marking using COEM standard!');
            showEssay();
        }

        function backToMain() {
            document.getElementById('main-cards').style.display = 'grid';
            document.getElementById('dynamic-content').innerHTML = '';
            if (timerInterval) clearInterval(timerInterval);
            document.removeEventListener('keydown', handleKeydown);
            currentQuestion = 0;
            timeLeft = 2400;
            answers = {};
            currentQuestions = [];
        }

        // Show main cards on page load
        window.onload = function() {
            document.getElementById('main-cards').style.display = 'grid';
            document.getElementById('dynamic-content').innerHTML = '';
        }

        // Toggle mobile sidebar
        function toggleMobileSidebar(forceOpen) {
            const sidebar = document.getElementById('mobile-sidebar');
            const backdrop = document.getElementById('sidebar-backdrop');
            const btn = document.getElementById('mobileMenuBtn');
            const isOpen = !sidebar.classList.contains('-translate-x-full');
            const willOpen = typeof forceOpen === 'boolean' ? forceOpen : !isOpen;

            if (willOpen) {
                sidebar.classList.remove('-translate-x-full');
                backdrop.classList.remove('hidden');
                sidebar.setAttribute('aria-hidden', 'false');
                if (btn) btn.setAttribute('aria-expanded', 'true');
                document.body.style.overflow = 'hidden';
                const firstInteractive = sidebar.querySelector('a, button');
                if (firstInteractive) firstInteractive.focus();
            } else {
                sidebar.classList.add('-translate-x-full');
                backdrop.classList.add('hidden');
                sidebar.setAttribute('aria-hidden', 'true');
                if (btn) btn.setAttribute('aria-expanded', 'false');
                document.body.style.overflow = '';
                if (btn) btn.focus();
            }
        }
    </script>
</body>
</html>